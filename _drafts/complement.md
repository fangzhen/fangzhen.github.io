---
layout: post
title: 理解补码
tags: complement
date: 2023-06-02
update: 2023-05-31
---

补码：补到溢出的距离

n+1位的有符号数，负数(-a)补码对应的无符号数为`2^(n+1) - a`
例如3位，-3的补码为101，对应无符号数5的编码。

小写字母a代表整数，对应大写字母A代表该数值的补码表示对应的无符号数数值。M代表2^(n+1)。
那么 如果a>=0, 有A=a,
如果a<0, 有 A=M-(-a)

**对于n+1位加法器，我们要证明`加法器使用补码表示计算出来的结果`=`算术结果的补码表示`**
取值范围：0<A=a<2^n-1, 1< b < 2^n -> 2^n <= B=(M-b) <2^(n+1)

### a+(-b)
a -> A
-b -> B
算术结果 a+(-b) = a+(M-b)-M = A+B-M = r。r不会溢出n+1位有符号数的范围
补码表示：
r>0 -> r = A+B-M
r<0 -> M-(-r) = A+B


加法器使用补码表示整数，计算a+(-b)，其实是计算A+B，计算结果：
如果A+B>M，溢出，加法器的结果是A+B-M，
否则是A+B。
和算术结果的补码表示相同。

### (-a)+(-b)
-a -> A
-b -> B
`(-a)+(-b) = (M-a)+(M-b)-M*2 = A+B-M*2 = r`。r一定小于0，但有可能溢出n+1位有符号数的范围
如果不溢出，补码表示 `M-(-r) = M-(-(A+B-M*2)) = A+B-M`
-3-2 = 13+14 -32 = -5 ->11
如果溢出(r<-(2^(n-1))， 即A+B-M < 2^(n-1))，结果无意义，例如

加法器结果：
因为2M>A+B>M，溢出所以结果为A+B-M。
对于r溢出的情况(即M<A+B<1.5M)，加法器一般也不会特殊处理，结果还是A+B-M,但是按有符号数来解释就变成了正数

-3-7 = 13+9 - 32 = -10 -> 6(溢出，对应无符号数为正数)
